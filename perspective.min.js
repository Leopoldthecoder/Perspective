"use strict";var perspective={};perspective.hover=function(t){t=void 0===arguments[0]||arguments[0];var e,r=[],o=document.getElementsByTagName("div");for(Array.from(o).forEach(function(t){"hover"===t.getAttribute("data-perspective")&&r.push(t)}),e=0;e<r.length;e++)!function(e){function o(t){for(var e=0;e<c;e++)t(e)}function n(t,e,r){for(var o=["webkitTransform","msTransform","transform"],n=0;n<o.length;n++)t.style[o[n]]="translate("+e+"px,"+r+"px)"}function s(t,e,r,o){var s=Math.floor(o*(.5*document.body.clientWidth-e)),a=Math.floor(o*(.5*document.body.clientHeight-r));n(t,s,a)}var a,l=[],i=r[e],p=[];for(a=0;a<i.childNodes.length;a++)1===i.childNodes[a].nodeType&&(l.push(i.childNodes[a]),null!==i.childNodes[a].getAttribute("data-hover-speed")&&p.push(i.childNodes[a].getAttribute("data-hover-speed")));var c=l.length,u=!1;if(p.length<c)for(a=p.length;a<c;a++)p.push(.2);i.onmousemove=function(t){u||o(function(e){s(l[e],t.clientX,t.clientY,p[e])})},i.onmouseleave=function(e){t&&(o(function(t){l[t].style.transition="0.1s"}),u||o(function(t){n(l[t],0,0)}))},i.onmouseenter=function(t){u=!0,o(function(e){l[e].style.transition="0.1s",s(l[e],t.clientX,t.clientY,p[e])}),setTimeout(function(){u=!1,o(function(t){l[t].style.transition="0s"})},100)}}(e)},perspective.scroll=function(){function t(t){var e,r="rgb(",o=t.toLowerCase();if(4===o.length){var n="#";for(e=1;e<4;e++)n+=o.slice(e,e+1).concat(o.slice(e,e+1));o=n}for(e=1;e<4;e++)r+=parseInt("0x"+o.slice(2*e-1,2*e+1)).toString(),e<3&&(r+=",");return r+=")"}function e(t){r(t,0),x=t?C[t-1]:t,o(x,!0)}function r(t,r){var o=u[t],n=document.getElementById("persp-controller").getElementsByTagName("li");f=!0,1===r&&t++,o.target.parentNode.style.transition="0.5s",o.target.parentNode.style.top="-"+100*t+"%",setTimeout(function(){f=!1},500);var s;for(s=0;s<n.length;s++)!function(r){var o=n[r].getElementsByTagName("div")[0];r!==t?(o.style.backgroundColor="transparent",o.onmouseover=function(){o.style.backgroundColor="#999",o.parentNode.getElementsByTagName("span")[0].style.display="inline-block",o.parentNode.getElementsByTagName("span")[0].style.opacity="1"},o.onmouseout=function(){o.style.backgroundColor="transparent",o.parentNode.getElementsByTagName("span")[0].style.opacity="0",setTimeout(function(){o.parentNode.getElementsByTagName("span")[0].style.display="none"},200)},o.onclick=function(){e(r)}):(o.style.backgroundColor="#999",o.onmouseover=function(){return!1},o.onmouseout=function(){o.style.backgroundColor="#999",o.parentNode.getElementsByTagName("span")[0].style.opacity="0",setTimeout(function(){o.parentNode.getElementsByTagName("span")[0].style.display="none"},200)},o.onclick=function(){return!1})}(s)}function o(t,e){var r,o=0,n={},s=0;for(r=0;r<C.length;r++)t>=C[r]&&o++;for(n=u[o],r=0;r<o;r++)s+=u[r].sLength+1;if(!e&&!f||e){if(e)for(r=0;r<n.childCount;r++)n.layers[r].style.transition="0s";else f=!0,setTimeout(function(){f=!1},1e3*n.sDuration);for(r=0;r<n.childCount;r++)for(var a=0;a<n.attr[r].length;a++)n.layers[r].style[n.attr[r][a]]=n.prop[r][a][t-s]}e&&setTimeout(function(){for(r=0;r<n.childCount;r++)n.layers[r].style.transition=n.sDuration+"s"},50)}function n(t){if(!f){var e=t.wheelDelta?t.wheelDelta:-t.detail,n=!1;if(e<0&&x===E||e>0&&0===x)return!1;e<0&&x++,e>0&&x--;for(var s=0;s<C.length;s++){if(e<0&&x===C[s]){r(s,1),o(x,!0),n=!0;break}if(e>0&&x===C[s]-1){r(s,-1),o(x,!0),n=!0;break}}n||o(x,!1)}return!1}var s,a,l,i,p=arguments,c=document.getElementsByTagName("div"),u=[],d=/-?\d+(?:\.\d+)?/g,g=/^#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/,f=!1;for(a=0;a<c.length;a++)if("scroll"===c[a].getAttribute("data-perspective")){var h=c[a];for(l=0;l<h.childNodes.length;l++)if(1===h.childNodes[l].nodeType){var y=h.childNodes[l];for(s=[],i=0;i<y.childNodes.length;i++)1===y.childNodes[i].nodeType&&s.push(y.childNodes[i])}}var m=s.length;for(a=0;a<m;a++){for(u[a]={},u[a].target=s[a],u[a].target.style.transition="0.5s",u[a].sLength=parseInt(void 0===u[a].target.getAttribute("data-scroll-number")?1:u[a].target.getAttribute("data-scroll-number")),u[a].cssArr=p[a],l=0;l<u[a].cssArr.length;l++){var v=u[a].cssArr[l].length;for(i=0;i<v;i++){g.test(u[a].cssArr[l][i].toString().replace(/\s+/g,""))&&(u[a].cssArr[l][i]=t(u[a].cssArr[l][i].toString().replace(/\s+/g,"")));var N=["transform","animation"];N.forEach(function(t){if(u[a].cssArr[l][i].toString().toLowerCase()===t){var e=["webkit","ms"];t=t.replace(/(\w)/,function(t){return t.toUpperCase()});for(var r=0;r<e.length;r++)u[a].cssArr[l].push(e[r]+t),u[a].cssArr[l].push(u[a].cssArr[l][i+1]),u[a].cssArr[l].push(u[a].cssArr[l][i+2])}})}}for(u[a].layers=[],l=0;l<u[a].target.childNodes.length;l++)1===u[a].target.childNodes[l].nodeType&&u[a].layers.push(u[a].target.childNodes[l]);for(u[a].childCount=u[a].cssArr.length,u[a].layers=u[a].layers.slice(0,u[a].childCount),u[a].sDuration=p[m]?p[m][a]:.2,u[a].attr=[],u[a].prop=[],u[a].propNum=[],u[a].propStr=[],l=0;l<u[a].childCount;l++){for(u[a].layers[l].style.transition=u[a].sDuration+"s",u[a].attr[l]=[],u[a].prop[l]=[],u[a].propNum[l]=[],u[a].propStr[l]=[],i=0;i<u[a].cssArr[l].length;i++)switch(i%3){case 0:u[a].attr[l].push(u[a].cssArr[l][i]),u[a].propNum[l][i/3]=[],u[a].propStr[l][i/3]=[];break;case 1:u[a].propNum[l][Math.floor(i/3)][0]=u[a].cssArr[l][i].toString().match(d),u[a].propStr[l][Math.floor(i/3)]=u[a].cssArr[l][i].toString().split(d);break;case 2:u[a].propNum[l][Math.floor(i/3)][1]=u[a].cssArr[l][i].toString().match(d)}for(i=0;i<u[a].cssArr[l].length/3;i++){u[a].delta=[];for(var b=0;b<u[a].propNum[l][i][0].length;b++)u[a].delta[b]=(u[a].propNum[l][i][1][b]-u[a].propNum[l][i][0][b])/u[a].sLength;u[a].prop[l][i]=[];for(var A=0;A<=u[a].sLength;A++)if(0===A)u[a].prop[l][i][A]=u[a].cssArr[l][3*i+1];else{var T=void 0;for(u[a].prop[l][i][A]="",T=0;T<u[a].propNum[l][i][0].length;T++)A===u[a].sLength?u[a].prop[l][i][A]+=u[a].propStr[l][i][T]+u[a].propNum[l][i][1][T]:u[a].propStr[l][i].join("").indexOf("rgb")>-1?u[a].prop[l][i][A]+=u[a].propStr[l][i][T]+Math.floor(parseFloat(u[a].propNum[l][i][0][T])+u[a].delta[T]*A):u[a].prop[l][i][A]+=u[a].propStr[l][i][T]+(parseFloat(u[a].propNum[l][i][0][T])+u[a].delta[T]*A);u[a].prop[l][i][A]+=u[a].propStr[l][i][T]}}}}var x=0,C=[],E=0;for(a=0;a<u.length-1;a++)E+=u[a].sLength,C.push(E+a+1);E+=u[u.length-1].sLength+u.length-1,document.addEventListener&&document.addEventListener("DOMMouseScroll",n,!1),document.onmousewheel=n;var S=document.createElement("ul");for(S.setAttribute("id","persp-controller"),a=0;a<u.length;a++){var k=document.createElement("li"),L=document.createElement("div"),w=document.createElement("span");k.style.listStyle="none",k.style.display="block",k.style.position="relative",L.style.height="8px",L.style.width="8px",L.style.border="1px solid #fff",L.style.backgroundColor="transparent",L.style.boxShadow="0 0 1px 1px #999",L.style.borderRadius="50%",L.style.margin="16px 0",L.style.transition="0.2s",L.style.cursor="pointer",w.innerHTML=u[a].target.getAttribute("data-scroll-tag"),w.style.color="#777",w.style.font="12px arial",w.style.padding="2px 10px",w.style.backgroundColor="rgba(255,255,255,0.8)",w.style.borderRadius="4px",w.style.position="absolute",w.style.left="15px",w.style.top="-4px",w.style.transition="0.2s",w.style.opacity="0",k.appendChild(L),k.appendChild(w),S.appendChild(k)}S.style.position="absolute",S.style.left="2%",S.style.top="50%",S.style.marginTop=-1*(13*u.length+8)+"px",S.style.zIndex=1e3,u[0].target.parentNode.parentNode.appendChild(S),r(0,0)},module.exports=perspective;
